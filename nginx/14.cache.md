# Caching with ngx_http_proxy_module

The `ngx_http_proxy_module` in Nginx provides powerful caching capabilities for responses from proxied servers. Proper caching can improve performance, reduce backend load, and speed up response times.

---

## `proxy_cache_path` Directive

Defines the location and parameters for the cache.

- **levels:** Directory structure for storing cache files.
- **keys_zone:** Name and size of the shared memory zone for cache keys.
- **inactive:** Time after which unused cache items are removed.
- **max_size:** Maximum size of the cache.

**Example:**
```nginx
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m inactive=60m max_size=1g;
```

---

## `proxy_cache` Directive

Enables caching for a specific context and specifies which cache zone to use.

**Example:**
```nginx
location /api/ {
    proxy_cache my_cache;
    proxy_pass http://backend;
}
```

---

## `proxy_cache_valid` Directive

Sets how long responses with specific status codes are considered valid in the cache.

**Example:**
```nginx
proxy_cache_valid 200 302 10m;
proxy_cache_valid 404 1m;
```

---

## Adding Headers for Cache

You can add headers to indicate cache status using the `add_header` directive.

**Example:**
```nginx
add_header X-Cache-Status $upstream_cache_status;
```

---

## `proxy_cache_key` Directive

Defines the key used to store and retrieve cached responses.

**Example:**
```nginx
proxy_cache_key "$scheme$request_method$host$request_uri";
```

---

## `proxy_cache_bypass` Directive

Specifies conditions under which the cache should be bypassed.

**Example:**
```nginx
proxy_cache_bypass $cookie_nocache $arg_nocache;
```

---

## `proxy_cache_use_stale` Directive

Allows serving stale cached content when certain errors occur.

**Example:**
```nginx
proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;
```

---

## `proxy_cache_lock` Directive

Prevents multiple requests from simultaneously fetching the same resource from the backend when it is not yet cached.

**Example:**
```nginx
proxy_cache_lock on;
```

---

## Example Configuration

```nginx
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m inactive=60m max_size=1g;

server {
    location /api/ {
        proxy_cache my_cache;
        proxy_cache_key "$scheme$request_method$host$request_uri";
        proxy_cache_valid 200 302 10m;
        proxy_cache_valid 404 1m;
        proxy_cache_bypass $cookie_nocache $arg_nocache;
        proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;
        proxy_cache_lock on;
        add_header X-Cache-Status $upstream_cache_status;
        proxy_pass http://backend;
    }
}
```

This configuration sets up a cache for `/api/` requests, controls cache size and duration, adds cache status headers, and handles cache locking and